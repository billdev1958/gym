<!DOCTYPE html>
<html th:replace="~{layouts/main :: layout(~{::title}, ~{::content})}">
<th:block th:fragment="title">Clientes</th:block>

<div th:fragment="content">

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h1>Clientes</h1>
            <p style="color: #86868b;">Gestión de miembros y vigencias.</p>
        </div>
        <a href="/sales/new" class="btn-apple" style="width: auto; padding: 0 20px;">+ Nuevo Cliente</a>
    </div>

    <div style="border: 1px solid #d2d2d7; border-radius: 12px; overflow: hidden;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead style="background-color: #f5f5f7; border-bottom: 1px solid #d2d2d7;">
                <tr>
                    <th
                        style="padding: 15px; text-align: left; font-size: 12px; color: #86868b; text-transform: uppercase;">
                        Cliente</th>
                    <th
                        style="padding: 15px; text-align: left; font-size: 12px; color: #86868b; text-transform: uppercase;">
                        Membresía</th>
                    <th
                        style="padding: 15px; text-align: left; font-size: 12px; color: #86868b; text-transform: uppercase;">
                        Vencimiento</th>
                    <th
                        style="padding: 15px; text-align: center; font-size: 12px; color: #86868b; text-transform: uppercase;">
                        Estado</th>
                    <th
                        style="padding: 15px; text-align: right; font-size: 12px; color: #86868b; text-transform: uppercase;">
                        Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="client : ${clients}" style="border-bottom: 1px solid #f5f5f7;">

                    <td style="padding: 15px;">
                        <div style="font-weight: 600;" th:text="${client.user.name + ' ' + client.user.lastname1}">
                            Nombre</div>
                        <div style="font-size: 11px; color: #86868b;"
                            th:text="'ID: ' + ${client.user.id.toString().substring(0,8)}"></div>
                    </td>

                    <td style="padding: 15px;">
                        <span th:text="${client.membershipType.name}">Gold</span>
                    </td>

                    <td style="padding: 15px; font-family: monospace; font-size: 13px;"
                        th:text="${#temporals.format(client.endDate, 'dd/MM/yyyy')}">
                        01/01/2025
                    </td>

                    <td style="padding: 15px; text-align: center;"
                        th:with="isActive=${client.endDate.isAfter(T(java.time.LocalDate).now()) or client.endDate.isEqual(T(java.time.LocalDate).now())}">

                        <span th:if="${isActive}"
                            style="background: #1d1d1f; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600;">
                            ACTIVO
                        </span>

                        <span th:unless="${isActive}"
                            style="background: #e5e5ea; color: #86868b; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600;">
                            VENCIDO
                        </span>
                    </td>

                    <td style="padding: 15px; text-align: right; white-space: nowrap;">

                        <a th:href="@{/clients/details/{id}(id=${client.user.id})}"
                            style="text-decoration: none; color: #0071e3; margin-right: 15px; font-size: 14px;">Ver</a>

                        <th:block th:if="${client.endDate.isBefore(T(java.time.LocalDate).now())}">
                            <a th:href="@{/sales/renew/{id}(id=${client.user.id})}"
                                style="text-decoration: none; color: #1d1d1f; margin-right: 15px; font-size: 14px; font-weight: 500;">
                                Renovar
                            </a>
                        </th:block>

                        <th:block th:unless="${client.endDate.isBefore(T(java.time.LocalDate).now())}">
                            <span
                                style="color: #d2d2d7; margin-right: 15px; font-size: 14px; cursor: default;">Vigente</span>
                        </th:block>

                        <form th:action="@{/clients/delete/{id}(id=${client.user.id})}" method="post"
                            style="display: inline;">
                            <button type="submit" onclick="return confirm('¿Dar de baja a este cliente?');"
                                style="background: none; border: none; color: #ff3b30; cursor: pointer; font-size: 14px;">
                                Baja
                            </button>
                        </form>
                    </td>
                </tr>

                <tr th:if="${clients.empty}">
                    <td colspan="5" style="padding: 40px; text-align: center; color: #86868b;">
                        No hay clientes registrados.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

</html>